<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Reaction Counter</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #0088cc;
            --primary-dark: #006699;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --border: #e9ecef;
            --text: #333;
            --text-muted: #6c757d;
        }
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text);
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; padding: 40px 0 30px; color: white; }
        .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .card { background: white; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 20px; }
        .card-header { display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
        .card-header h2 { font-size: 1.3rem; font-weight: 600; }
        .card-header .icon { font-size: 1.5rem; margin-right: 12px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 8px; }
        .form-group input, .form-group select { width: 100%; padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px; font-size: 1rem; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary); }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .checkbox-group { display: flex; align-items: center; gap: 10px; }
        .checkbox-group input[type="checkbox"] { width: 20px; height: 20px; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 24px; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn-sm { padding: 8px 16px; font-size: 0.9rem; }
        .login-steps { display: flex; gap: 20px; margin-bottom: 20px; }
        .login-step { flex: 1; text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .login-step.active { background: #e8f4fd; border: 2px solid var(--primary); }
        .login-step.completed { background: #d4edda; }
        .login-step .step-number { width: 30px; height: 30px; background: var(--secondary); color: white; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 600; margin-bottom: 8px; }
        .login-step.active .step-number { background: var(--primary); }
        .login-step.completed .step-number { background: var(--success); }
        .saved-sessions { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
        .session-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px; }
        .session-info { display: flex; align-items: center; gap: 10px; }
        .progress-container { margin: 20px 0; }
        .progress-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #667eea); transition: width 0.3s; }
        .progress-text { margin-top: 8px; font-size: 0.9rem; color: var(--text-muted); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 12px; text-align: center; }
        .stat-card .value { font-size: 2rem; font-weight: 700; }
        .stat-card .label { font-size: 0.9rem; opacity: 0.9; margin-top: 5px; }
        .message-list { max-height: 600px; overflow-y: auto; }
        .message-item { display: flex; gap: 15px; padding: 15px; border-bottom: 1px solid var(--border); }
        .message-item:hover { background: #f8f9fa; }
        .message-rank { font-size: 1.5rem; font-weight: 700; color: var(--primary); min-width: 40px; }
        .message-content { flex: 1; }
        .message-text { font-size: 0.95rem; margin-bottom: 8px; word-break: break-word; }
        .message-meta { display: flex; flex-wrap: wrap; gap: 15px; font-size: 0.85rem; color: var(--text-muted); }
        .message-reactions { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .reaction-badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: #f0f0f0; border-radius: 20px; font-size: 0.85rem; }
        .message-link { color: var(--primary); text-decoration: none; }
        .spinner { width: 40px; height: 40px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        .spinner-sm { width: 20px; height: 20px; border-width: 2px; margin: 0; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .dialog-list { max-height: 350px; overflow-y: auto; }
        .dialog-search { position: sticky; top: 0; background: white; padding: 10px 0; margin-bottom: 10px; }
        .dialog-search input { width: 100%; padding: 10px 15px; border: 2px solid var(--border); border-radius: 8px; }
        .dialog-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; cursor: pointer; }
        .dialog-item:hover { background: #f0f0f0; }
        .dialog-icon { font-size: 1.5rem; }
        .dialog-name { flex: 1; font-weight: 500; }
        .dialog-username { color: var(--text-muted); font-size: 0.85rem; }
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 2px solid var(--border); padding-bottom: 5px; }
        .tab { padding: 10px 20px; border: none; background: none; font-size: 1rem; font-weight: 500; color: var(--text-muted); cursor: pointer; border-radius: 8px 8px 0 0; }
        .tab.active { color: var(--primary); background: rgba(0,136,204,0.1); }
        .hidden { display: none !important; }
        .emoji-stats { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .emoji-stat { display: flex; align-items: center; gap: 6px; padding: 8px 12px; background: #f8f9fa; border-radius: 8px; }
        .export-section { display: flex; gap: 10px; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
        .alert { padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .alert-info { background: #e8f4fd; color: #0c5460; }
        .alert-warning { background: #fff3cd; color: #856404; }
        .user-info { display: flex; align-items: center; gap: 15px; padding: 15px; background: #d4edda; border-radius: 10px; margin-bottom: 20px; }
        .user-avatar { width: 50px; height: 50px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; }
        .user-details { flex: 1; }
        .user-name { font-weight: 600; font-size: 1.1rem; }
        .user-phone { color: var(--text-muted); font-size: 0.9rem; }

        /* è¡¨æƒ…é€‰æ‹©å™¨ */
        .emoji-selector { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .emoji-selector-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .emoji-selector-title { font-weight: 600; }
        .emoji-grid { display: flex; flex-wrap: wrap; gap: 6px; max-height: 200px; overflow-y: auto; padding: 5px; }
        .emoji-option { padding: 6px 10px; background: white; border: 2px solid var(--border); border-radius: 8px; cursor: pointer; font-size: 1.1rem; transition: all 0.2s; }
        .emoji-option:hover { border-color: var(--primary); transform: scale(1.1); }
        .emoji-option.selected { border-color: var(--primary); background: #e8f4fd; }
        .emoji-history { margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border); }
        .emoji-history-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px; }

        /* æ—¶é—´é€‰æ‹©å™¨ */
        .time-range-selector { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 10px; }
        .time-preset { padding: 8px 16px; background: #f8f9fa; border: 2px solid var(--border); border-radius: 8px; cursor: pointer; font-size: 0.9rem; }
        .time-preset:hover { border-color: var(--primary); }
        .time-preset.active { border-color: var(--primary); background: #e8f4fd; }
        .custom-date-range { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 10px; }
        .custom-date-range input[type="date"] { padding: 8px 12px; border: 2px solid var(--border); border-radius: 8px; }

        /* å†å²è®°å½• */
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; }
        .history-item:hover { background: #e8f4fd; }
        .history-info { display: flex; flex-direction: column; gap: 4px; }
        .history-channel { font-weight: 600; }
        .history-date { font-size: 0.85rem; color: var(--text-muted); }
        .history-stats { display: flex; align-items: center; gap: 15px; font-size: 0.9rem; color: var(--text-muted); }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .form-row { grid-template-columns: 1fr; }
            .login-steps { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ“Š Telegram Reaction Counter</h1>
            <p>ç»Ÿè®¡é¢‘é“/ç¾¤ç»„æ¶ˆæ¯ååº”ï¼Œæ‰¾å‡ºæœ€çƒ­é—¨çš„å†…å®¹</p>
        </header>

        <!-- ç™»å½•åŒºåŸŸ -->
        <div class="card" id="login-section">
            <div class="card-header">
                <span class="icon">ğŸ”</span>
                <h2>ç™»å½• Telegram</h2>
            </div>
            
            <div id="logged-in-view" class="hidden">
                <div class="user-info">
                    <div class="user-avatar">ğŸ‘¤</div>
                    <div class="user-details">
                        <div class="user-name" id="user-name">ç”¨æˆ·å</div>
                        <div class="user-phone" id="user-phone">+86 ****</div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline btn-sm" onclick="switchAccount()">åˆ‡æ¢è´¦å·</button>
                        <button class="btn btn-danger btn-sm" onclick="logout(false)">é€€å‡ºç™»å½•</button>
                    </div>
                </div>
            </div>

            <div id="login-view">
                <div class="login-steps">
                    <div class="login-step active" id="step-1">
                        <div class="step-number">1</div>
                        <div class="step-title">è¾“å…¥æ‰‹æœºå·</div>
                    </div>
                    <div class="login-step" id="step-2">
                        <div class="step-number">2</div>
                        <div class="step-title">è¾“å…¥éªŒè¯ç </div>
                    </div>
                    <div class="login-step" id="step-3">
                        <div class="step-number">3</div>
                        <div class="step-title">å®Œæˆç™»å½•</div>
                    </div>
                </div>

                <div id="phone-step">
                    <div class="alert alert-info">
                        ğŸ’¡ Telegram ä½¿ç”¨æ‰‹æœºå· + éªŒè¯ç ç™»å½•ã€‚éªŒè¯ç ä¼šå‘é€åˆ°ä½ çš„ Telegram åº”ç”¨ã€‚
                    </div>
                    <div class="form-group">
                        <label>æ‰‹æœºå·</label>
                        <input type="tel" id="phone-input" placeholder="ä¾‹å¦‚ï¼š+8613800138000">
                    </div>
                    <button class="btn btn-primary" id="btn-send-code" onclick="sendCode()">ğŸ“± å‘é€éªŒè¯ç </button>
                </div>

                <div id="code-step" class="hidden">
                    <div class="alert alert-warning">ğŸ“© éªŒè¯ç å·²å‘é€åˆ°ä½ çš„ Telegram åº”ç”¨ã€‚</div>
                    <div class="form-group">
                        <label>éªŒè¯ç </label>
                        <input type="text" id="code-input" placeholder="è¾“å…¥éªŒè¯ç " maxlength="10">
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="btn-verify-code" onclick="verifyCode()">âœ“ éªŒè¯ç™»å½•</button>
                        <button class="btn btn-secondary" onclick="resetLogin()">é‡æ–°è¾“å…¥</button>
                    </div>
                </div>

                <div id="password-step" class="hidden">
                    <div class="alert alert-warning">ğŸ”’ è¯¥è´¦å·å¯ç”¨äº†ä¸¤æ­¥éªŒè¯ï¼Œè¯·è¾“å…¥å¯†ç ã€‚</div>
                    <div class="form-group">
                        <label>ä¸¤æ­¥éªŒè¯å¯†ç </label>
                        <input type="password" id="password-input" placeholder="è¾“å…¥å¯†ç ">
                    </div>
                    <button class="btn btn-primary" onclick="verifyPassword()">âœ“ éªŒè¯å¯†ç </button>
                </div>

                <div class="saved-sessions" id="saved-sessions">
                    <h4 style="margin-bottom: 15px;">ğŸ“‚ å·²ä¿å­˜çš„ç™»å½•</h4>
                    <div id="sessions-list"></div>
                </div>
            </div>
        </div>

        <!-- åˆ†æè®¾ç½® -->
        <div class="card" id="analysis-section">
            <div class="card-header">
                <span class="icon">ğŸ”</span>
                <h2>åˆ†æè®¾ç½®</h2>
            </div>

            <div id="analysis-form">
                <div class="form-group">
                    <label>ç›®æ ‡é¢‘é“/ç¾¤ç»„</label>
                    <input type="text" id="channel-input" placeholder="è¾“å…¥é¢‘é“ç”¨æˆ·åæˆ–ä»ä¸‹æ–¹é€‰æ‹©">
                </div>

                <button class="btn btn-secondary" onclick="loadDialogs()" style="margin-bottom: 20px;">
                    ğŸ“‹ ä»å·²åŠ å…¥çš„é¢‘é“ä¸­é€‰æ‹©
                </button>

                <div id="dialog-list-container" class="hidden">
                    <div class="dialog-search">
                        <input type="text" id="dialog-search" placeholder="ğŸ” æœç´¢é¢‘é“/ç¾¤ç»„..." oninput="filterDialogs()">
                    </div>
                    <div class="dialog-list" id="dialog-list"></div>
                </div>

                <!-- æ—¶é—´èŒƒå›´ -->
                <div class="form-group">
                    <label>è·å–æ¶ˆæ¯æ—¶é—´èŒƒå›´</label>
                    <div class="time-range-selector">
                        <button class="time-preset" data-days="3" onclick="selectTimePreset(this)">æœ€è¿‘3å¤©</button>
                        <button class="time-preset active" data-days="7" onclick="selectTimePreset(this)">æœ€è¿‘7å¤©</button>
                        <button class="time-preset" data-days="30" onclick="selectTimePreset(this)">æœ€è¿‘30å¤©</button>
                        <button class="time-preset" data-days="90" onclick="selectTimePreset(this)">æœ€è¿‘3ä¸ªæœˆ</button>
                        <button class="time-preset" data-days="365" onclick="selectTimePreset(this)">æœ€è¿‘1å¹´</button>
                        <button class="time-preset" data-days="0" onclick="selectTimePreset(this)">å…¨éƒ¨æ¶ˆæ¯</button>
                        <button class="time-preset" data-days="-1" onclick="selectTimePreset(this)">è‡ªå®šä¹‰æ—¥æœŸ</button>
                    </div>
                    <div class="custom-date-range hidden" id="custom-date-range">
                        <label>ä»</label>
                        <input type="date" id="date-from">
                        <label>åˆ°</label>
                        <input type="date" id="date-to">
                    </div>
                    <input type="hidden" id="days-input" value="7">
                </div>

                <!-- è¡¨æƒ…é€‰æ‹©å™¨ - å¸¸é©» -->
                <div class="emoji-selector">
                    <div class="emoji-selector-header">
                        <span class="emoji-selector-title">ğŸ­ é€‰æ‹©è¦ç»Ÿè®¡çš„è¡¨æƒ…ï¼ˆå¯å¤šé€‰ï¼‰</span>
                        <button class="btn btn-sm btn-outline" onclick="toggleAllEmojis()">å…¨é€‰/å–æ¶ˆå…¨é€‰</button>
                    </div>
                    <div class="emoji-grid" id="emoji-grid">
                        <!-- Telegram æ”¯æŒçš„æ‰€æœ‰ååº”è¡¨æƒ… -->
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ‘</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ‘</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">â¤ï¸</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ”¥</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¥°</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ‘</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤”</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤¯</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜±</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤¬</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜¢</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ‰</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤©</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤®</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ’©</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ™</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ‘Œ</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ•Š</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤¡</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¥±</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¥´</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ³</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">â¤ï¸â€ğŸ”¥</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸŒš</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸŒ­</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ’¯</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤£</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">âš¡</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸŒ</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ†</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ’”</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤¨</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ“</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¾</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ’‹</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ–•</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜ˆ</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜´</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜­</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤“</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ‘»</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ‘¨â€ğŸ’»</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ‘€</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸƒ</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ™ˆ</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜‡</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜¨</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">âœï¸</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤—</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ«¡</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ…</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ„</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">â˜ƒï¸</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ’…</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤ª</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ—¿</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ†’</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ’˜</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ™‰</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¦„</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜˜</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ’Š</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ™Š</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ‘¾</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤·</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤·â€â™‚ï¸</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ¤·â€â™€ï¸</span>
                        <span class="emoji-option" onclick="toggleEmoji(this)">ğŸ˜¡</span>
                    </div>
                </div>

                <div class="form-row" style="margin-top: 20px;">
                    <div class="form-group">
                        <label>æœ€å°ååº”æ•°</label>
                        <input type="number" id="min-reactions-input" value="5" min="1">
                    </div>
                    <div class="form-group">
                        <label>æ’åºæ–¹å¼</label>
                        <select id="sort-select">
                            <option value="views" selected>æŒ‰æµè§ˆé‡</option>
                            <option value="engagement">æŒ‰äº’åŠ¨ç‡</option>
                            <option value="replies">æŒ‰å›å¤æ•°</option>
                        </select>
                        <p class="sort-hint hidden" id="sort-hint" style="font-size: 0.85rem; color: var(--text-muted); margin-top: 5px;">
                            ğŸ’¡ å·²é€‰æ‹©è¡¨æƒ…ï¼Œå°†ä¼˜å…ˆæŒ‰é€‰ä¸­è¡¨æƒ…æ•°é‡æ’åº
                        </p>
                    </div>
                </div>

                <div class="form-group">
                    <label>æ¶ˆæ¯ç±»å‹</label>
                    <select id="media-filter-select">
                        <option value="all">å…¨éƒ¨æ¶ˆæ¯</option>
                        <option value="media">ä»…åŒ…å«åª’ä½“çš„æ¶ˆæ¯</option>
                    </select>
                </div>

                <button class="btn btn-primary" id="btn-analyze" onclick="startAnalysis()">ğŸš€ å¼€å§‹åˆ†æ</button>
            </div>

            <div id="progress-container" class="progress-container hidden">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
                <div class="progress-text" id="progress-text">å‡†å¤‡ä¸­...</div>
            </div>
        </div>

        <!-- ç»“æœ -->
        <div class="card hidden" id="results-section">
            <div class="card-header">
                <span class="icon">ğŸ“ˆ</span>
                <h2>åˆ†æç»“æœ</h2>
            </div>

            <div class="stats-grid" id="stats-grid"></div>

            <div id="emoji-stats-container">
                <h3 style="margin-bottom: 10px;">ğŸ­ çƒ­é—¨è¡¨æƒ…</h3>
                <div class="emoji-stats" id="emoji-stats"></div>
            </div>

            <div style="margin-top: 20px;">
                <h3 style="margin-bottom: 10px;">ğŸ“ æ¶ˆæ¯åˆ—è¡¨</h3>
                <div class="message-list" id="message-list"></div>
            </div>

            <div class="export-section">
                <button class="btn btn-success" onclick="exportData('json')">ğŸ“„ å¯¼å‡º JSON</button>
            </div>
        </div>

        <!-- å†å²è®°å½• -->
        <div class="card" id="history-section">
            <div class="card-header">
                <span class="icon">ğŸ“‚</span>
                <h2>å†å²åˆ†æè®°å½•</h2>
            </div>
            <div id="history-list">
                <p style="color: var(--text-muted);">æš‚æ— å†å²è®°å½•</p>
            </div>
        </div>

        <!-- é¡µè„š -->
        <footer style="text-align: center; padding: 20px 0; color: rgba(255,255,255,0.8); font-size: 0.9rem;">
            <a href="https://github.com/unknowlei/Telegram-Message-Reaction-Counter" target="_blank" style="color: white; text-decoration: none; display: inline-flex; align-items: center; gap: 6px;">
                <svg height="20" width="20" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
                GitHub
            </a>
        </footer>
    </div>

    <script>
        let isLoggedIn = false;
        let analysisData = null;
        let allDialogs = [];
        let selectedEmojis = [];
        let savedResults = JSON.parse(localStorage.getItem('savedResults') || '[]');

        document.addEventListener('DOMContentLoaded', () => {
            checkStatus();
            loadSavedSessions();
            loadSavedResults();
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date(Date.now() - 7*24*60*60*1000).toISOString().split('T')[0];
            document.getElementById('date-to').value = today;
            document.getElementById('date-from').value = weekAgo;
            
            document.getElementById('phone-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendCode();
            });
            document.getElementById('code-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') verifyCode();
            });
        });

        // å†å²è®°å½•åŠŸèƒ½
        function loadSavedResults() {
            const container = document.getElementById('history-list');
            if (!container) return;
            
            if (savedResults.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted);">æš‚æ— å†å²è®°å½•</p>';
                return;
            }
            
            container.innerHTML = savedResults.map((r, i) => `
                <div class="history-item" onclick="loadHistoryResult(${i})">
                    <div class="history-info">
                        <span class="history-channel">ğŸ“¢ ${escapeHtml(r.channel)}</span>
                        <span class="history-date">${new Date(r.timestamp).toLocaleString()}</span>
                    </div>
                    <div class="history-stats">
                        <span>${r.messageCount} æ¡æ¶ˆæ¯</span>
                        <button class="btn btn-danger btn-sm" onclick="event.stopPropagation(); deleteHistoryResult(${i})">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function saveResult(data, channel) {
            const result = {
                channel: channel,
                timestamp: new Date().toISOString(),
                messageCount: data.total_count,
                data: data
            };
            savedResults.unshift(result);
            // æœ€å¤šä¿å­˜10æ¡è®°å½•
            if (savedResults.length > 10) {
                savedResults = savedResults.slice(0, 10);
            }
            localStorage.setItem('savedResults', JSON.stringify(savedResults));
            loadSavedResults();
        }

        function loadHistoryResult(index) {
            const result = savedResults[index];
            if (result && result.data) {
                showResults(result.data);
            }
        }

        function deleteHistoryResult(index) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²è®°å½•å—ï¼Ÿ')) return;
            savedResults.splice(index, 1);
            localStorage.setItem('savedResults', JSON.stringify(savedResults));
            loadSavedResults();
        }

        function toggleEmoji(el) {
            el.classList.toggle('selected');
            updateSelectedEmojis();
        }

        function updateSelectedEmojis() {
            selectedEmojis = Array.from(document.querySelectorAll('.emoji-option.selected'))
                .map(e => e.textContent.trim());
            
            // æ˜¾ç¤º/éšè—æ’åºæç¤º
            const sortHint = document.getElementById('sort-hint');
            if (selectedEmojis.length > 0) {
                sortHint.classList.remove('hidden');
            } else {
                sortHint.classList.add('hidden');
            }
        }

        function toggleAllEmojis() {
            const options = document.querySelectorAll('#emoji-grid .emoji-option');
            const allSelected = Array.from(options).every(o => o.classList.contains('selected'));
            
            options.forEach(o => {
                if (allSelected) {
                    o.classList.remove('selected');
                } else {
                    o.classList.add('selected');
                }
            });
            updateSelectedEmojis();
        }

        function selectTimePreset(btn) {
            document.querySelectorAll('.time-preset').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const days = parseInt(btn.dataset.days);
            document.getElementById('days-input').value = days;
            
            const customRange = document.getElementById('custom-date-range');
            if (days === -1) {
                customRange.classList.remove('hidden');
            } else {
                customRange.classList.add('hidden');
            }
        }

        async function checkStatus() {
            try {
                const res = await fetch('/api/status');
                const data = await res.json();
                if (data.is_logged_in && data.user) {
                    showLoggedIn(data.user);
                } else if (data.awaiting_code) {
                    showCodeStep();
                }
            } catch (e) {
                console.error('Failed to check status:', e);
            }
        }

        async function loadSavedSessions() {
            try {
                const res = await fetch('/api/sessions');
                const data = await res.json();
                const list = document.getElementById('sessions-list');
                const container = document.getElementById('saved-sessions');
                
                if (data.success && data.sessions.length > 0) {
                    list.innerHTML = data.sessions.map(s => `
                        <div class="session-item">
                            <div class="session-info">
                                <span>ğŸ“±</span>
                                <span>${s.display}</span>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-primary btn-sm" onclick="quickLogin('${s.phone}')">å¿«é€Ÿç™»å½•</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteSession('${s.file}')">åˆ é™¤</button>
                            </div>
                        </div>
                    `).join('');
                    container.classList.remove('hidden');
                } else {
                    container.classList.add('hidden');
                }
            } catch (e) {
                console.error('Failed to load sessions:', e);
            }
        }

        async function quickLogin(phone) {
            document.getElementById('phone-input').value = phone;
            await sendCode();
        }

        async function deleteSession(filename) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç™»å½•è®°å½•å—ï¼Ÿ')) return;
            try {
                const res = await fetch('/api/delete_session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ filename: filename })
                });
                const data = await res.json();
                if (data.success) {
                    loadSavedSessions();
                } else {
                    alert('åˆ é™¤å¤±è´¥: ' + data.error);
                }
            } catch (e) {
                alert('åˆ é™¤å¤±è´¥: ' + e.message);
            }
        }

        async function sendCode() {
            const phone = document.getElementById('phone-input').value.trim();
            if (!phone) { alert('è¯·è¾“å…¥æ‰‹æœºå·'); return; }
            const btn = document.getElementById('btn-send-code');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner spinner-sm"></span> å‘é€ä¸­...';
            try {
                const res = await fetch('/api/send_code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: phone })
                });
                const data = await res.json();
                if (data.success) {
                    if (data.already_logged_in) {
                        showLoggedIn(data.user);
                    } else {
                        showCodeStep();
                    }
                } else {
                    alert('å‘é€å¤±è´¥: ' + data.error);
                }
            } catch (e) {
                alert('è¯·æ±‚å¤±è´¥: ' + e.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ“± å‘é€éªŒè¯ç ';
            }
        }

        function showCodeStep() {
            document.getElementById('phone-step').classList.add('hidden');
            document.getElementById('code-step').classList.remove('hidden');
            document.getElementById('step-1').classList.remove('active');
            document.getElementById('step-1').classList.add('completed');
            document.getElementById('step-2').classList.add('active');
            document.getElementById('code-input').focus();
        }

        function resetLogin() {
            document.getElementById('phone-step').classList.remove('hidden');
            document.getElementById('code-step').classList.add('hidden');
            document.getElementById('password-step').classList.add('hidden');
            document.getElementById('step-1').classList.add('active');
            document.getElementById('step-1').classList.remove('completed');
            document.getElementById('step-2').classList.remove('active');
            document.getElementById('code-input').value = '';
        }

        async function verifyCode() {
            const code = document.getElementById('code-input').value.trim();
            if (!code) { alert('è¯·è¾“å…¥éªŒè¯ç '); return; }
            const btn = document.getElementById('btn-verify-code');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner spinner-sm"></span> éªŒè¯ä¸­...';
            try {
                const res = await fetch('/api/verify_code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });
                const data = await res.json();
                if (data.success) {
                    showLoggedIn(data.user);
                    loadSavedSessions();
                } else if (data.need_password) {
                    document.getElementById('code-step').classList.add('hidden');
                    document.getElementById('password-step').classList.remove('hidden');
                } else {
                    alert('éªŒè¯å¤±è´¥: ' + data.error);
                }
            } catch (e) {
                alert('è¯·æ±‚å¤±è´¥: ' + e.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'âœ“ éªŒè¯ç™»å½•';
            }
        }

        async function verifyPassword() {
            const password = document.getElementById('password-input').value;
            if (!password) { alert('è¯·è¾“å…¥å¯†ç '); return; }
            try {
                const res = await fetch('/api/verify_password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: password })
                });
                const data = await res.json();
                if (data.success) {
                    showLoggedIn(data.user);
                    loadSavedSessions();
                } else {
                    alert('éªŒè¯å¤±è´¥: ' + data.error);
                }
            } catch (e) {
                alert('è¯·æ±‚å¤±è´¥: ' + e.message);
            }
        }

        function showLoggedIn(user) {
            isLoggedIn = true;
            document.getElementById('login-view').classList.add('hidden');
            document.getElementById('logged-in-view').classList.remove('hidden');
            document.getElementById('user-name').textContent = user.name + (user.username ? ` (@${user.username})` : '');
            document.getElementById('user-phone').textContent = user.phone ? '+' + user.phone : '';
            document.querySelectorAll('.login-step').forEach(s => {
                s.classList.remove('active');
                s.classList.add('completed');
            });
        }

        function switchAccount() { logout(false); }

        async function logout(deleteSession = false) {
            if (!confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) return;
            try {
                await fetch('/api/logout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ delete_session: deleteSession })
                });
                isLoggedIn = false;
                document.getElementById('login-view').classList.remove('hidden');
                document.getElementById('logged-in-view').classList.add('hidden');
                resetLogin();
                loadSavedSessions();
                document.getElementById('results-section').classList.add('hidden');
            } catch (e) {
                console.error('Logout error:', e);
            }
        }

        async function loadDialogs() {
            if (!isLoggedIn) { alert('è¯·å…ˆç™»å½•'); return; }
            const container = document.getElementById('dialog-list-container');
            const list = document.getElementById('dialog-list');
            container.classList.remove('hidden');
            list.innerHTML = '<div class="spinner"></div>';
            try {
                const res = await fetch('/api/dialogs');
                const data = await res.json();
                if (data.success) {
                    allDialogs = data.dialogs;
                    renderDialogs(allDialogs);
                } else {
                    list.innerHTML = '<p style="padding:20px;color:var(--danger);">åŠ è½½å¤±è´¥: ' + data.error + '</p>';
                }
            } catch (e) {
                list.innerHTML = '<p style="padding:20px;color:var(--danger);">åŠ è½½å¤±è´¥: ' + e.message + '</p>';
            }
        }

        function renderDialogs(dialogs) {
            const list = document.getElementById('dialog-list');
            list.innerHTML = dialogs.map(d => {
                // ä¼˜å…ˆä½¿ç”¨ usernameï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨åç§°
                // åç«¯å¯ä»¥é€šè¿‡åç§°æˆ– username æ¥è·å–é¢‘é“
                const displayId = d.username ? '@' + d.username : 'ID: ' + d.id;
                // å­˜å‚¨å®Œæ•´ä¿¡æ¯ä¾›é€‰æ‹©æ—¶ä½¿ç”¨
                const dialogData = JSON.stringify({username: d.username, id: d.id, name: d.name}).replace(/"/g, '&quot;');
                return `
                    <div class="dialog-item" onclick='selectDialogByData(${JSON.stringify({username: d.username, id: d.id, name: d.name})})'>
                        <span class="dialog-icon">${d.is_channel ? 'ğŸ“¢' : 'ğŸ‘¥'}</span>
                        <span class="dialog-name">${escapeHtml(d.name)}</span>
                        <span class="dialog-username">${displayId}</span>
                    </div>
                `;
            }).join('');
        }

        function filterDialogs() {
            const query = document.getElementById('dialog-search').value.toLowerCase();
            const filtered = allDialogs.filter(d => 
                d.name.toLowerCase().includes(query) || 
                (d.username && d.username.toLowerCase().includes(query))
            );
            renderDialogs(filtered);
        }

        function selectDialog(identifier) {
            document.getElementById('channel-input').value = identifier;
            document.getElementById('dialog-list-container').classList.add('hidden');
        }

        function selectDialogByData(dialogData) {
            // ä¼˜å…ˆä½¿ç”¨ usernameï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨åç§°ï¼ˆåç«¯ä¼šç”¨åç§°æœç´¢ï¼‰
            let identifier;
            if (dialogData.username) {
                identifier = '@' + dialogData.username;
            } else {
                // ä½¿ç”¨åç§°ï¼Œåç«¯ä¼šå°è¯•ç”¨åç§°æœç´¢
                identifier = dialogData.name;
            }
            document.getElementById('channel-input').value = identifier;
            document.getElementById('dialog-list-container').classList.add('hidden');
        }

        async function startAnalysis() {
            if (!isLoggedIn) { alert('è¯·å…ˆç™»å½•'); return; }
            const channel = document.getElementById('channel-input').value.trim();
            if (!channel) { alert('è¯·è¾“å…¥é¢‘é“'); return; }

            const btn = document.getElementById('btn-analyze');
            const progressContainer = document.getElementById('progress-container');
            btn.disabled = true;
            progressContainer.classList.remove('hidden');

            // å¤„ç†æ—¶é—´èŒƒå›´
            let days = parseInt(document.getElementById('days-input').value);
            let dateFrom = null, dateTo = null;
            if (days === -1) {
                dateFrom = document.getElementById('date-from').value;
                dateTo = document.getElementById('date-to').value;
            }

            try {
                const res = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        channel: channel,
                        days: days,
                        date_from: dateFrom,
                        date_to: dateTo,
                        min_reactions: parseInt(document.getElementById('min-reactions-input').value),
                        media_only: document.getElementById('media-filter-select').value === 'media',
                        sort_by: document.getElementById('sort-select').value,
                        emojis: selectedEmojis
                    })
                });
                const data = await res.json();
                if (data.success) {
                    pollProgress();
                } else {
                    alert('å¯åŠ¨å¤±è´¥: ' + data.error);
                    btn.disabled = false;
                    progressContainer.classList.add('hidden');
                }
            } catch (e) {
                alert('è¯·æ±‚å¤±è´¥: ' + e.message);
                btn.disabled = false;
                progressContainer.classList.add('hidden');
            }
        }

        async function pollProgress() {
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const btn = document.getElementById('btn-analyze');
            const progressContainer = document.getElementById('progress-container');
            try {
                const res = await fetch('/api/progress');
                const data = await res.json();
                progressFill.style.width = data.progress + '%';
                progressText.textContent = data.message;
                if (data.status === 'completed') {
                    btn.disabled = false;
                    progressContainer.classList.add('hidden');
                    // ä¿å­˜ç»“æœåˆ°å†å²è®°å½•
                    const channel = document.getElementById('channel-input').value.trim();
                    saveResult(data.data, channel);
                    showResults(data.data);
                } else if (data.status === 'error') {
                    btn.disabled = false;
                    progressContainer.classList.add('hidden');
                    alert('åˆ†æå¤±è´¥: ' + data.message);
                } else {
                    setTimeout(pollProgress, 500);
                }
            } catch (e) {
                setTimeout(pollProgress, 1000);
            }
        }

        function showResults(data) {
            const resultsSection = document.getElementById('results-section');
            resultsSection.classList.remove('hidden');
            const stats = data.stats;
            document.getElementById('stats-grid').innerHTML = `
                <div class="stat-card"><div class="value">${data.total_count}</div><div class="label">æ¶ˆæ¯æ•°é‡</div></div>
                <div class="stat-card"><div class="value">${stats.total_reactions}</div><div class="label">æ€»ååº”æ•°</div></div>
                <div class="stat-card"><div class="value">${stats.total_views || 0}</div><div class="label">æ€»æµè§ˆé‡</div></div>
                <div class="stat-card"><div class="value">${stats.avg_reactions.toFixed(1)}</div><div class="label">å¹³å‡ååº”</div></div>
            `;
            const emojiStats = document.getElementById('emoji-stats');
            if (stats.reaction_stats && stats.reaction_stats.top_emojis) {
                emojiStats.innerHTML = stats.reaction_stats.top_emojis.slice(0, 10).map(([emoji, count]) => `
                    <div class="emoji-stat"><span style="font-size:1.2rem">${emoji}</span><span style="font-weight:600">${count}</span></div>
                `).join('');
            }
            const messageList = document.getElementById('message-list');
            messageList.innerHTML = data.messages.map((msg, i) => {
                // å¤„ç†æ–°æ—§é“¾æ¥æ ¼å¼å…¼å®¹
                const tgLink = msg.link?.tg_link || msg.link;
                const webLink = msg.link?.web_link || msg.link;
                return `
                <div class="message-item">
                    <div class="message-rank">#${i + 1}</div>
                    <div class="message-content">
                        <div class="message-text">${escapeHtml(msg.text || '[åª’ä½“æ–‡ä»¶]').substring(0, 200)}${msg.text && msg.text.length > 200 ? '...' : ''}</div>
                        <div class="message-meta">
                            <span>ğŸ”¥ ${msg.total_reactions} ååº”</span>
                            ${msg.views ? `<span>ğŸ‘ ${msg.views} æµè§ˆ</span>` : ''}
                            ${msg.replies ? `<span>ğŸ’¬ ${msg.replies} å›å¤</span>` : ''}
                            ${msg.selected_emoji_count ? `<span>ğŸ¯ é€‰ä¸­è¡¨æƒ…: ${msg.selected_emoji_count}</span>` : ''}
                            ${msg.media && msg.media.type ? `<span>ğŸ“ ${msg.media.type}</span>` : ''}
                            <a href="${tgLink}" onclick="openTelegramLink(event, '${tgLink}', '${webLink}')" class="message-link">ğŸ”— åœ¨Telegramä¸­æ‰“å¼€</a>
                        </div>
                        <div class="message-reactions">
                            ${msg.reactions.map(r => `<span class="reaction-badge">${r.emoji} ${r.count}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `}).join('');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        async function exportData(format) {
            try {
                const res = await fetch('/api/export', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ format: format })
                });
                if (res.ok) {
                    const blob = await res.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `top_messages.${format}`;
                    a.click();
                } else {
                    alert('å¯¼å‡ºå¤±è´¥');
                }
            } catch (e) {
                alert('å¯¼å‡ºå¤±è´¥: ' + e.message);
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ‰“å¼€Telegramé“¾æ¥ï¼Œç›´æ¥ä½¿ç”¨æ·±åº¦é“¾æ¥è·³è½¬
        function openTelegramLink(event, tgLink, webLink) {
            event.preventDefault();
            // ç›´æ¥è·³è½¬åˆ°æ·±åº¦é“¾æ¥ï¼Œè®©ç³»ç»Ÿå¤„ç†
            window.location.href = tgLink;
        }
    </script>
</body>
</html>